<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Victoria Suburb House Prices (2010-2020)</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5.20.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.1.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.20.2"></script>
</head>
<body>

<h1>Victoria Suburb House Prices (2010-2020)</h1>
<div id="vis"></div>

<script type="text/javascript">
    var spec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "title": "Suburb House Prices (2010-2020)",
        "width": 900,  // Set wider map
        "height": 600,
        "params": [
            {
                "name": "Year_selection",
                "value": 2018,
                "bind": {
                    "input": "range",
                    "min": 2010,
                    "max": 2020,
                    "step": 1,
                    "name": "Select Year: "
                }
            }
        ],
        "projection": {
            "type": "mercator",
            "center": [144.9, -37.5],  // Fixed center to Melbourne CBD
            "scale": 18000  // Fixed zoom level
        },
        "layer": [
            {
                "data": {
                    "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/6_advanced_examples/data/VIC_LOCALITY_POLYGON_SHP.json",
                    "format": {"type": "topojson", "feature": "VIC_LOCALITY_POLYGON_SHP"}
                },
                "transform": [
                    {
                        "calculate": "'No data available for ' + datum.properties.NAME",
                        "as": "note"
                    }
                ],
                "mark": {
                    "type": "geoshape",
                    "fill": "#f0f0f0",
                    "stroke": "#ccc",
                    "strokeWidth": 0.8
                },
                "encoding": {
                    "tooltip": {"field": "note"}
                }
            },
            {
                "data": {
                    "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/6_advanced_examples/data/house_price_by_suburb_long_format.csv"
                },
                "transform": [
                    {
                        "lookup": "locality",
                        "from": {
                            "data": {
                                "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/6_advanced_examples/data/VIC_LOCALITY_POLYGON_SHP.json",
                                "format": {
                                    "type": "topojson",
                                    "feature": "VIC_LOCALITY_POLYGON_SHP"
                                }
                            },
                            "key": "properties.NAME"
                        },
                        "as": "geo"
                    },
                    {"filter": "datum.year == Year_selection"}
                ],
                "mark": {
                    "type": "geoshape",
                    "stroke": "#333",
                    "strokeWidth": 0.5
                },
                "encoding": {
                    "shape": {"field": "geo", "type": "geojson"},
                    "color": {
                        "field": "price",
                        "type": "quantitative",
                        "scale": {"domain": [300000, 2000000], "scheme": "greens"},
                        "legend": {"format": ".2s", "title": "House Prices"}
                    },
                    "tooltip": [
                        {"field": "locality", "type": "nominal", "title": "Suburb"},
                        {
                            "field": "price",
                            "type": "quantitative",
                            "title": "Median Price (AUD)",
                            "format": "$,.0f"
                        },
                        {"field": "year", "type": "quantitative", "title": "Year"}
                    ]
                }
            }
        ],
        "config": {
            "title": {
                "fontSize": 18,
                "font": "Arial",
                "color": "#4f4f4f"
            },
            "axis": {
                "labelFontSize": 12,
                "titleFontSize": 14
            }
        }
    };

    vegaEmbed('#vis', spec).then(function(result) {
        // You can add interaction code here if needed
    }).catch(console.error);
</script>

</body>
</html>
